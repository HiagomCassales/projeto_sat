<!-- Template: admin_template.html -->

{% extends 'shared/base.html' %}

{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<h1>Bem-vindo ao Painel de Administração</h1>
<p>Escolha uma categoria para visualizar:</p>
<ul>
    <li><a href="{% url 'sgdc_view' %}">SGDC</a></li>
    <li><a href="{% url 'lessonia_view' %}">Lessonia</a></li>
    <li><a href="{% url 'infraestruturas_criticas_view' %}">Infraestruturas Críticas</a></li>
</ul>

<h2>Usuários Pendentes de Aprovação</h2>
<table class="table">
    <thead>
        <tr>
            <th>Usuário</th>
            <th>Categorias</th>
            <th>Ação</th>
        </tr>
    </thead>
    <tbody>
        {% for user in pending_users %}
        <tr>
            <td>{{ user.username }}</td>
            <td>{{ user.categories.all|join:", " }}</td>
            <td>
                <form method="post" action="{% url 'approve_user' user.id %}" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-success">Aprovar</button>
                </form>
                <form method="post" action="{% url 'reject_user' user.id %}" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">Rejeitar</button>
                </form>
                <form method="post" action="{% url 'delete_user' user.id %}" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-warning">Excluir</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<h2>Usuários Aprovados</h2>
<table class="table">
    <thead>
        <tr>
            <th>Usuário</th>
            <th>Categorias</th>
            <th>Ação</th>
        </tr>
    </thead>
    <tbody>
        {% for user in approved_users %}
        <tr>
            <td>{{ user.username }}</td>
            <td>{{ user.categories.all|join:", " }}</td>
            <td>
                <form method="post" action="{% url 'delete_user' user.id %}" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">Excluir</button>
                </form>
                <form method="post" action="{% url 'change_category' user.id %}" style="display:inline;">
                    {% csrf_token %}
                    <select name="categories" class="form-control d-inline" multiple style="width: auto;">
                        {% for category in categories %}
                            <option value="{{ category.id }}" {% if category in user.categories.all %}selected{% endif %}>{{ category.get_name_display }}</option>
                        {% endfor %}
                    </select>
                    <button type="submit" class="btn btn-primary">Alterar Categorias</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
