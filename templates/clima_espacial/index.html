{% extends 'shared/base.html' %}

{% block title %}Clima Espacial{% endblock %}

{% block content %}
<h1>Clima Espacial</h1>
{% if not briefing %}
    <a href="{% url 'clima_espacial:new_clima' %}" class="btn btn-primary">Cadastrar Clima de Hoje</a>
{% endif %}

<h2 class="mt-4">Climas Cadastrados</h2>
<table id="climaTable" class="table table-striped table-bordered" style="width:100%">
    <thead>
        <tr>
            <th>Data</th>
            <th>Maior K nas últimas 24h</th>
            <th>Maior K previsto até D+2</th>
            <th>Tempestade Solar Prevista</th>
            <th>Ações</th>
        </tr>
    </thead>
    <tbody>
        {% for clima in briefings %}
        <tr>
            <td>{{ clima.data|date:"d/m/Y" }}</td>
            <td>{{ clima.maior_k_24h }}</td>
            <td>{{ clima.maior_k_previsto }}</td>
            <td>{{ clima.tempestade_solar_prevista }}</td>
            <td>
                <a href="{% url 'clima_espacial:edit_clima' clima.pk %}" class="btn btn-warning btn-sm">Editar</a>
                <a href="{% url 'clima_espacial:delete_clima' clima.pk %}" class="btn btn-danger btn-sm" onclick="return confirm('Tem certeza que deseja excluir este clima?');">Remover</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- DataTables CSS -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap5.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.2.3/css/buttons.bootstrap5.min.css">
<!-- DataTables JS -->
<script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.2.3/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.2.3/js/buttons.bootstrap5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.2.3/js/buttons.html5.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var showAddButton = {{ briefing|yesno:"false,true" }};
        
        var table = new DataTable('#climaTable', {
            buttons: [
                {
                    text: 'Adicionar Clima',
                    action: function (e, dt, node, config) {
                        window.location.href = "{% url 'clima_espacial:new_clima' %}";
                    },
                    className: 'btn btn-primary'
                }
            ],
            dom: 'Bfrtip'
        });

        if (!showAddButton) {
            table.buttons().container().appendTo('#climaTable_wrapper .col-md-6:eq(0)');
        } else {
            table.buttons().disable();
        }
    });
</script>
{% endblock %}
